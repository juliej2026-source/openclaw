<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>OpenClaw — System Overview</title>
    <link rel="icon" type="image/svg+xml" href="/img/favicon.svg" />
    <style>
      :root {
        --bg: #faf9f7;
        --surface: #ffffff;
        --surface-warm: #f5f3ef;
        --border: #e8e4df;
        --border-light: #f0ece7;
        --text: #2c2a27;
        --text-dim: #7a756d;
        --text-light: #a39e95;
        --accent: #8b6d4a;
        --accent-light: #c4a97d;
        --accent-warm: #d4a574;
        --teal: #5a8f8b;
        --indigo: #6b7394;
        --sage: #7a8f6d;
        --rose: #a07070;
        --slate: #6b7280;
        --gold: #b8963e;
        --shadow-sm: 0 1px 3px rgba(44, 42, 39, 0.06);
        --shadow-md: 0 4px 16px rgba(44, 42, 39, 0.08);
        --shadow-lg: 0 8px 32px rgba(44, 42, 39, 0.1);
        --radius: 4px;
        --mono: "SF Mono", "Cascadia Code", "Consolas", monospace;
        --serif: "Georgia", "Palatino", "Times New Roman", serif;
        --sans: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Segoe UI", sans-serif;
      }

      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        background: var(--bg);
        color: var(--text);
        font-family: var(--sans);
        font-weight: 400;
        line-height: 1.7;
        min-height: 100vh;
        -webkit-font-smoothing: antialiased;
      }

      /* ── Layout ── */
      .wrap {
        max-width: 920px;
        margin: 0 auto;
        padding: 48px 32px 80px;
      }

      /* ── Header ── */
      .header {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        padding: 0 0 32px;
        margin-bottom: 40px;
        border-bottom: 1px solid var(--border);
      }
      .header-brand h1 {
        font-family: var(--serif);
        font-size: 32px;
        font-weight: 500;
        color: var(--text);
        letter-spacing: -0.02em;
        line-height: 1.2;
      }
      .header-brand .subtitle {
        font-family: var(--sans);
        font-size: 13px;
        font-weight: 400;
        color: var(--text-dim);
        margin-top: 4px;
        letter-spacing: 0.03em;
      }
      .header-meta {
        text-align: right;
        font-size: 12px;
        color: var(--text-light);
        font-family: var(--mono);
      }
      .header-meta .live-indicator {
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .live-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--sage);
        box-shadow: 0 0 4px rgba(122, 143, 109, 0.4);
      }

      /* ── Navigation ── */
      .nav {
        display: flex;
        gap: 0;
        margin-bottom: 48px;
        border-bottom: 1px solid var(--border);
      }
      .nav-btn {
        background: none;
        border: none;
        font-family: var(--sans);
        font-size: 13px;
        font-weight: 400;
        color: var(--text-light);
        padding: 12px 20px;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        letter-spacing: 0.02em;
        transition:
          color 0.2s,
          border-color 0.2s;
        white-space: nowrap;
      }
      .nav-btn:hover {
        color: var(--text-dim);
      }
      .nav-btn.active {
        color: var(--accent);
        border-bottom-color: var(--accent);
        font-weight: 500;
      }

      /* ── Tab panels ── */
      .panel {
        display: none;
      }
      .panel.active {
        display: block;
      }

      /* ── Sections ── */
      .section {
        margin-bottom: 56px;
      }
      .section-label {
        font-family: var(--mono);
        font-size: 11px;
        font-weight: 500;
        color: var(--text-light);
        text-transform: uppercase;
        letter-spacing: 0.12em;
        margin-bottom: 16px;
      }
      .section-heading {
        font-family: var(--serif);
        font-size: 24px;
        font-weight: 500;
        color: var(--text);
        margin-bottom: 12px;
        letter-spacing: -0.01em;
      }
      .section-body {
        font-size: 15px;
        color: var(--text-dim);
        line-height: 1.8;
        max-width: 680px;
      }

      /* ── Stat row ── */
      .stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1px;
        background: var(--border);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        overflow: hidden;
        margin: 32px 0;
      }
      .stat {
        background: var(--surface);
        padding: 24px 20px;
        text-align: center;
      }
      .stat-value {
        font-family: var(--serif);
        font-size: 36px;
        font-weight: 600;
        color: var(--text);
        line-height: 1;
      }
      .stat-label {
        font-size: 12px;
        color: var(--text-light);
        margin-top: 6px;
        letter-spacing: 0.04em;
      }

      /* ── Cards grid ── */
      .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 16px;
        margin: 24px 0;
      }
      .card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 24px;
        transition:
          box-shadow 0.25s,
          transform 0.25s;
      }
      .card:hover {
        box-shadow: var(--shadow-md);
        transform: translateY(-1px);
      }
      .card-title {
        font-family: var(--sans);
        font-size: 14px;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .card-title .marker {
        width: 8px;
        height: 8px;
        border-radius: 2px;
        flex-shrink: 0;
      }
      .card-desc {
        font-size: 13px;
        color: var(--text-dim);
        line-height: 1.6;
      }
      .card-caps {
        margin-top: 12px;
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }
      .cap-tag {
        font-family: var(--mono);
        font-size: 10px;
        color: var(--text-light);
        background: var(--surface-warm);
        border: 1px solid var(--border-light);
        border-radius: 3px;
        padding: 2px 8px;
      }

      /* ── SVG container ── */
      .diagram {
        width: 100%;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        overflow: hidden;
        margin: 24px 0;
      }
      .diagram svg {
        width: 100%;
        height: auto;
        display: block;
      }

      /* ── Tech badges ── */
      .badge-row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin: 16px 0;
      }
      .badge {
        font-family: var(--mono);
        font-size: 11px;
        color: var(--text-dim);
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 3px;
        padding: 4px 12px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .badge .bdot {
        width: 5px;
        height: 5px;
        border-radius: 50%;
      }

      /* ── Channel grid ── */
      .ch-group {
        margin-bottom: 32px;
      }
      .ch-group-label {
        font-family: var(--mono);
        font-size: 11px;
        font-weight: 500;
        color: var(--text-light);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--border-light);
      }
      .ch-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 8px;
      }
      .ch-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 14px;
        background: var(--surface);
        border: 1px solid var(--border-light);
        border-radius: var(--radius);
        font-size: 13px;
        color: var(--text);
        transition: box-shadow 0.2s;
      }
      .ch-item:hover {
        box-shadow: var(--shadow-sm);
      }
      .ch-icon {
        font-size: 16px;
        flex-shrink: 0;
        width: 24px;
        text-align: center;
      }

      /* ── Pipeline flow ── */
      .pipeline {
        display: flex;
        align-items: center;
        gap: 0;
        overflow-x: auto;
        padding: 20px 0;
      }
      .pipe-step {
        font-family: var(--mono);
        font-size: 11px;
        color: var(--text-dim);
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 8px 14px;
        white-space: nowrap;
        flex-shrink: 0;
      }
      .pipe-sep {
        color: var(--border);
        font-size: 12px;
        padding: 0 6px;
        flex-shrink: 0;
      }

      /* ── Detail panel ── */
      .detail {
        background: var(--surface-warm);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 24px;
        margin-top: 20px;
        display: none;
      }
      .detail.visible {
        display: block;
      }
      .detail h3 {
        font-family: var(--serif);
        font-size: 20px;
        font-weight: 500;
        color: var(--text);
        margin-bottom: 8px;
      }
      .detail p {
        font-size: 14px;
        color: var(--text-dim);
        line-height: 1.7;
        margin-bottom: 12px;
      }
      .detail ul {
        padding-left: 20px;
      }
      .detail li {
        font-size: 13px;
        color: var(--text-dim);
        margin-bottom: 4px;
      }

      /* ── Engine cards ── */
      .engine-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 12px;
      }
      .engine-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 20px;
        transition: box-shadow 0.2s;
      }
      .engine-card:hover {
        box-shadow: var(--shadow-sm);
      }
      .engine-card h4 {
        font-family: var(--sans);
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 8px;
      }
      .engine-card li {
        font-size: 11px;
        color: var(--text-dim);
        margin-bottom: 3px;
      }
      .engine-card ul {
        padding-left: 16px;
      }

      /* ── Status grid ── */
      .status-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 16px;
      }
      .status-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 24px;
      }
      .status-card .sc-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
      }
      .status-card .sc-name {
        font-family: var(--sans);
        font-size: 14px;
        font-weight: 600;
        color: var(--text);
      }
      .status-card .sc-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
      }
      .status-card .sc-line {
        font-family: var(--mono);
        font-size: 12px;
        color: var(--text-dim);
        margin-bottom: 4px;
      }

      /* ── Animations ── */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .panel.active .section {
        animation: fadeIn 0.5s ease both;
      }
      .panel.active .section:nth-child(1) {
        animation-delay: 0.05s;
      }
      .panel.active .section:nth-child(2) {
        animation-delay: 0.15s;
      }
      .panel.active .section:nth-child(3) {
        animation-delay: 0.25s;
      }
      .panel.active .section:nth-child(4) {
        animation-delay: 0.35s;
      }
      .panel.active .section:nth-child(5) {
        animation-delay: 0.45s;
      }

      /* ── Divider ── */
      .divider {
        border: none;
        border-top: 1px solid var(--border);
        margin: 48px 0;
      }

      /* ── Footer ── */
      .footer {
        text-align: center;
        padding: 40px 0 0;
        border-top: 1px solid var(--border);
        margin-top: 56px;
        font-family: var(--mono);
        font-size: 11px;
        color: var(--text-light);
      }

      /* ── Responsive ── */
      @media (max-width: 768px) {
        .wrap {
          padding: 32px 20px 60px;
        }
        .stats {
          grid-template-columns: repeat(2, 1fr);
        }
        .card-grid {
          grid-template-columns: 1fr;
        }
        .ch-grid {
          grid-template-columns: repeat(2, 1fr);
        }
        .engine-grid {
          grid-template-columns: 1fr 1fr;
        }
        .pipeline {
          flex-wrap: wrap;
          gap: 4px;
        }
        .nav {
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }
        .nav-btn {
          padding: 10px 14px;
          font-size: 12px;
        }
        .header-brand h1 {
          font-size: 26px;
        }
      }
      @media (max-width: 500px) {
        .stats {
          grid-template-columns: 1fr 1fr;
        }
        .ch-grid {
          grid-template-columns: 1fr;
        }
        .engine-grid {
          grid-template-columns: 1fr;
        }
        .status-grid {
          grid-template-columns: 1fr;
        }
        .stat-value {
          font-size: 28px;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap" id="app">
      <div
        style="
          color: var(--text-light);
          padding: 80px 0;
          text-align: center;
          font-family: var(--serif);
          font-size: 18px;
        "
      >
        Loading&hellip;
      </div>
    </div>
    <script>
      // =====================================================================
      // SUBSYSTEM DATA
      // =====================================================================
      const SUBSYSTEMS = {
        "hive-mind": {
          label: "Hive Mind",
          color: "#5a8f8b",
          abbr: "HM",
          desc: "Infrastructure monitoring hub \u2014 station API, network scanning, dual-WAN management, UniFi WiFi monitoring, Apache status, Discord integration",
          caps: [
            "Network scanning",
            "Dual-WAN failover",
            "UniFi polling",
            "BRAVIA control",
            "Discord bot",
            "Portal server",
            "Prometheus metrics",
          ],
        },
        "neural-graph": {
          label: "Neural Graph",
          color: "#6b7394",
          abbr: "NG",
          desc: "LangGraph + Convex AI orchestration backbone \u2014 capability nodes, maturation lifecycle, force-directed graph topology, myelinated pathways",
          caps: [
            "Capability nodes",
            "Maturation lifecycle",
            "Force-directed layout",
            "Myelin scoring",
            "Replication",
            "Pruning",
          ],
        },
        "meta-engine": {
          label: "Meta Engine",
          color: "#8b6d4a",
          abbr: "ME",
          desc: "Autonomous model selection \u2014 task classification, performance scoring, dynamic routing to cheapest/fastest/most capable model",
          caps: [
            "Task classification",
            "Model registry",
            "Performance scoring",
            "Dynamic routing",
            "Cost optimization",
          ],
        },
        "data-mine": {
          label: "Data Mine",
          color: "#7a8f6d",
          abbr: "DM",
          desc: "Scientific data mining \u2014 5 engines (statistics, timeseries, clustering, graph analytics, experiments), 216 tests, correlations, anomaly detection",
          caps: [
            "Statistics engine",
            "Time-series analysis",
            "K-means clustering",
            "Graph analytics",
            "A/B experiments",
            "Anomaly detection",
          ],
        },
        wellness: {
          label: "Wellness",
          color: "#a07070",
          abbr: "WC",
          desc: "Executive Mental Wellbeing Concierge \u2014 8 AI agents, 10 tools, PDPA privacy-by-design, crisis escalation, measurement scorecard",
          caps: [
            "8 AI agents",
            "10 tools",
            "PDPA compliance",
            "Crisis escalation",
            "4 risk tiers",
            "Wellness scorecard",
          ],
        },
        "hotel-scraper": {
          label: "Hotel Scraper",
          color: "#b8963e",
          abbr: "HS",
          desc: "Niseko hotel price comparison \u2014 5 data sources, entity resolution, Playwright browser automation, Convex-backed storage",
          caps: [
            "5 data sources",
            "Entity resolution",
            "Playwright automation",
            "Price comparison",
            "Convex storage",
          ],
        },
      };
      const SUB_KEYS = Object.keys(SUBSYSTEMS);

      // =====================================================================
      // CHANNEL DATA
      // =====================================================================
      const CHANNELS = {
        Core: [
          { icon: "\uD83D\uDCF1", name: "WhatsApp" },
          { icon: "\u2708", name: "Telegram" },
          { icon: "\uD83C\uDFAE", name: "Discord" },
          { icon: "#", name: "Slack" },
          { icon: "\uD83D\uDD12", name: "Signal" },
          { icon: "\uD83D\uDCAC", name: "iMessage" },
          { icon: "\uD83D\uDD17", name: "Matrix" },
        ],
        Enterprise: [
          { icon: "\uD83C\uDFE2", name: "Microsoft Teams" },
          { icon: "\uD83D\uDCBC", name: "Google Chat" },
          { icon: "\u2699", name: "Mattermost" },
          { icon: "\u2601", name: "Nextcloud Talk" },
          { icon: "\uD83E\uDD85", name: "Feishu" },
        ],
        "Asia-Pacific": [
          { icon: "\uD83D\uDFE2", name: "LINE" },
          { icon: "\uD83D\uDCF2", name: "Zalo" },
          { icon: "\uD83D\uDC64", name: "Zalo User" },
        ],
        "Social & Web3": [
          { icon: "\uD83C\uDF10", name: "Nostr" },
          { icon: "\uD83E\uDE90", name: "Tlon / Urbit" },
          { icon: "\uD83C\uDFAC", name: "Twitch" },
        ],
        Voice: [
          { icon: "\uD83D\uDCDE", name: "Voice Call" },
          { icon: "\uD83C\uDF99", name: "Talk Voice" },
        ],
        "Developer & Infrastructure": [
          { icon: "&gt;_", name: "IRC" },
          { icon: "\uD83E\uDD16", name: "LLM Task" },
          { icon: "\uD83E\uDDE0", name: "Memory Core" },
          { icon: "\uD83D\uDCCA", name: "Memory LanceDB" },
          { icon: "\uD83D\uDCF1", name: "Device Pair" },
        ],
      };

      // =====================================================================
      // NETWORK TOPOLOGY (from topology.js)
      // =====================================================================
      const NET_NODES = [
        {
          id: "UDM-Pro",
          label: "UDM Pro",
          ip: "10.1.8.1",
          role: "gateway",
          x: 400,
          y: 60,
          icon: "\u25C6",
        },
        {
          id: "HR02-5G",
          label: "HR02 5G",
          ip: "192.168.128.1",
          role: "modem",
          x: 150,
          y: 60,
          icon: "\u25B2",
        },
        {
          id: "Julie",
          label: "Julie",
          ip: "10.1.8.143",
          role: "ai",
          x: 150,
          y: 190,
          icon: "\u2605",
        },
        {
          id: "IOT-HUB",
          label: "IOT-HUB",
          ip: "10.1.8.158",
          role: "hub",
          x: 350,
          y: 190,
          icon: "\u2B22",
        },
        {
          id: "Caesar",
          label: "Caesar",
          ip: "10.1.8.82",
          role: "intel",
          x: 520,
          y: 190,
          icon: "\u25CF",
        },
        {
          id: "BRAVIA",
          label: "BRAVIA TV",
          ip: "10.1.8.194",
          role: "device",
          x: 520,
          y: 310,
          icon: "\u25A0",
        },
      ];
      const NET_LINKS = [
        { from: "UDM-Pro", to: "IOT-HUB", type: "wired" },
        { from: "UDM-Pro", to: "Julie", type: "wired" },
        { from: "UDM-Pro", to: "Caesar", type: "wired" },
        { from: "UDM-Pro", to: "BRAVIA", type: "wired" },
        { from: "HR02-5G", to: "IOT-HUB", type: "wireless" },
        { from: "Julie", to: "IOT-HUB", type: "api" },
        { from: "IOT-HUB", to: "Caesar", type: "api" },
        { from: "IOT-HUB", to: "BRAVIA", type: "api" },
      ];
      const ROLE_COLORS = {
        gateway: "#6b7394",
        modem: "#b8963e",
        ai: "#6b7394",
        hub: "#5a8f8b",
        worker: "#7a8f6d",
        intel: "#b8963e",
        device: "#a39e95",
      };

      // =====================================================================
      // WELLNESS AGENTS
      // =====================================================================
      const WELLNESS_AGENTS = [
        { name: "orchestrator", color: "#6b7394" },
        { name: "clinical_safety", color: "#a07070" },
        { name: "data_steward", color: "#8b6d4a" },
        { name: "daily_coach", color: "#7a8f6d" },
        { name: "concierge", color: "#b8963e" },
        { name: "rag_knowledge", color: "#5a8f8b" },
        { name: "device_integration", color: "#c4a97d" },
        { name: "evaluation_capa", color: "#a39e95" },
      ];

      // =====================================================================
      // FETCH
      // =====================================================================
      async function fetchJSON(u) {
        try {
          const r = await fetch(u);
          if (!r.ok) return null;
          return r.json();
        } catch {
          return null;
        }
      }
      async function fetchAll() {
        const k = [
          "identity",
          "dashboard",
          "scan",
          "neuralStatus",
          "neuralTopo",
          "dataMineStatus",
          "dataMineStats",
          "wellnessStatus",
          "wellnessAgents",
          "wellnessTools",
        ];
        const u = [
          "/api/network/identity",
          "/api/network/dashboard",
          "/api/network/scan",
          "/api/neural/status",
          "/api/neural/topology",
          "/api/data-mine/status",
          "/api/data-mine/stats",
          "/api/wellness/status",
          "/api/wellness/agents",
          "/api/wellness/tools",
        ];
        const r = await Promise.allSettled(u.map(fetchJSON));
        const d = {};
        k.forEach((k, i) => {
          d[k] = r[i].status === "fulfilled" ? r[i].value : null;
        });
        return d;
      }

      // =====================================================================
      // HELPERS
      // =====================================================================
      function esc(s) {
        const d = document.createElement("div");
        d.textContent = s;
        return d.innerHTML;
      }
      function formatUptime(s) {
        if (!s && s !== 0) return "\u2014";
        const h = Math.floor(s / 3600),
          m = Math.floor((s % 3600) / 60);
        if (h > 24) {
          const d = Math.floor(h / 24);
          return d + "d " + (h % 24) + "h";
        }
        return h > 0 ? h + "h " + m + "m" : m + "m";
      }
      function hexPoints(cx, cy, r) {
        return [0, 1, 2, 3, 4, 5]
          .map((i) => {
            const a = (Math.PI / 3) * i - Math.PI / 2;
            return (cx + r * Math.cos(a)).toFixed(1) + "," + (cy + r * Math.sin(a)).toFixed(1);
          })
          .join(" ");
      }
      function agentLabel(s) {
        return s.replace(/_/g, " ").replace(/\b\w/g, (c) => c.toUpperCase());
      }

      // =====================================================================
      // FORCE-DIRECTED LAYOUT (from neural-graph.js)
      // =====================================================================
      function layoutNodes(nodes, edges, width, height) {
        const cx = width / 2,
          cy = height / 2;
        const radius = Math.min(width, height) * 0.35;
        const positions = {};
        nodes.forEach((n, i) => {
          const angle = (2 * Math.PI * i) / nodes.length;
          positions[n.nodeId] = {
            x: cx + radius * Math.cos(angle),
            y: cy + radius * Math.sin(angle),
            vx: 0,
            vy: 0,
          };
        });
        const k = Math.sqrt((width * height) / Math.max(nodes.length, 1));
        for (let iter = 0; iter < 50; iter++) {
          const temp = 1 - iter / 50;
          for (let i = 0; i < nodes.length; i++) {
            for (let j = i + 1; j < nodes.length; j++) {
              const a = positions[nodes[i].nodeId],
                b = positions[nodes[j].nodeId];
              const dx = a.x - b.x,
                dy = a.y - b.y;
              const dist = Math.max(Math.sqrt(dx * dx + dy * dy), 1);
              const force = ((k * k) / dist) * temp * 0.5;
              const fx = (dx / dist) * force,
                fy = (dy / dist) * force;
              a.vx += fx;
              a.vy += fy;
              b.vx -= fx;
              b.vy -= fy;
            }
          }
          for (const edge of edges) {
            const a = positions[edge.sourceNodeId],
              b = positions[edge.targetNodeId];
            if (!a || !b) continue;
            const dx = a.x - b.x,
              dy = a.y - b.y;
            const dist = Math.max(Math.sqrt(dx * dx + dy * dy), 1);
            const force = ((dist - k) / k) * (edge.weight || 1) * temp;
            const fx = (dx / dist) * force,
              fy = (dy / dist) * force;
            a.vx -= fx;
            a.vy -= fy;
            b.vx += fx;
            b.vy += fy;
          }
          for (const node of nodes) {
            const p = positions[node.nodeId];
            p.x += p.vx * 0.3;
            p.y += p.vy * 0.3;
            p.vx *= 0.8;
            p.vy *= 0.8;
            p.x = Math.max(50, Math.min(width - 50, p.x));
            p.y = Math.max(50, Math.min(height - 50, p.y));
          }
        }
        return positions;
      }

      function fitnessColor(f) {
        return f > 70 ? "#7a8f6d" : f > 40 ? "#b8963e" : "#a07070";
      }
      const EDGE_COLORS = {
        data_flow: "#6b7394",
        dependency: "#8b6d4a",
        activation: "#5a8f8b",
        fallback: "#a07070",
      };

      // =====================================================================
      // STATE
      // =====================================================================
      let currentTab = "overview";
      let selectedArchNode = null;
      let _lastData = {};

      function switchTab(id) {
        currentTab = id;
        selectedArchNode = null;
        rerender();
      }
      function selectArchNode(key) {
        selectedArchNode = selectedArchNode === key ? null : key;
        rerender();
      }
      function rerender() {
        render(_lastData);
      }

      // =====================================================================
      // RENDER
      // =====================================================================
      function render(d) {
        const app = document.getElementById("app");
        const identity = d.identity || {};
        const scan = d.scan || {};
        const neural = d.neuralStatus || {};
        const topo = d.neuralTopo || {};
        const dataMine = d.dataMineStatus || {};
        const dmStats = d.dataMineStats || {};
        const wellness = d.wellnessStatus || {};
        const agents = d.wellnessAgents?.agents || d.wellnessAgents || [];
        const tools = d.wellnessTools?.tools || d.wellnessTools || [];
        const now = new Date().toLocaleTimeString();

        let h = "";

        // ── Header ──
        h += '<div class="header">';
        h += '<div class="header-brand"><h1>OpenClaw</h1>';
        h += '<div class="subtitle">System Overview</div></div>';
        h +=
          '<div class="header-meta"><div class="live-indicator"><span class="live-dot"></span> ' +
          esc(now) +
          "</div>";
        h +=
          '<div style="margin-top:4px">' +
          esc(identity.station_id || "") +
          " \u00B7 v" +
          esc(identity.version || "\u2014") +
          "</div></div>";
        h += "</div>";

        // ── Navigation ──
        const tabs = [
          { id: "overview", label: "Overview" },
          { id: "architecture", label: "Architecture" },
          { id: "channels", label: "Channels" },
          { id: "intelligence", label: "Intelligence" },
          { id: "applications", label: "Applications" },
          { id: "infrastructure", label: "Infrastructure" },
          { id: "dashboard", label: "Dashboard" },
        ];
        h += '<nav class="nav">';
        for (const t of tabs)
          h +=
            '<button class="nav-btn' +
            (currentTab === t.id ? " active" : "") +
            '" onclick="switchTab(\'' +
            t.id +
            "')\">" +
            t.label +
            "</button>";
        h += "</nav>";

        // ==================================================================
        // TAB 1: Overview
        // ==================================================================
        h += '<div class="panel' + (currentTab === "overview" ? " active" : "") + '">';

        // Hero diagram
        h += '<div class="section"><div class="diagram">';
        h +=
          '<svg viewBox="0 0 700 260" xmlns="http://www.w3.org/2000/svg" style="background:#faf9f7">';
        const hcx = 350,
          hcy = 130;
        // Center
        h +=
          '<polygon points="' +
          hexPoints(hcx, hcy, 32) +
          '" fill="none" stroke="var(--accent,#8b6d4a)" stroke-width="1.5" opacity="0.7"/>';
        h +=
          '<text x="' +
          hcx +
          '" y="' +
          (hcy + 4) +
          '" text-anchor="middle" fill="#2c2a27" font-family="Georgia,Palatino,serif" font-size="13" font-weight="500">OpenClaw</text>';
        // Subsystem nodes
        const heroR = 105;
        SUB_KEYS.forEach((key, i) => {
          const sub = SUBSYSTEMS[key];
          const angle = (Math.PI * 2 * i) / SUB_KEYS.length - Math.PI / 2;
          const nx = hcx + heroR * Math.cos(angle);
          const ny = hcy + heroR * Math.sin(angle);
          h +=
            '<line x1="' +
            hcx +
            '" y1="' +
            hcy +
            '" x2="' +
            nx.toFixed(1) +
            '" y2="' +
            ny.toFixed(1) +
            '" stroke="' +
            sub.color +
            '" stroke-width="1" opacity="0.25" stroke-dasharray="4 3">';
          h +=
            '<animate attributeName="stroke-dashoffset" values="0;-14" dur="4s" repeatCount="indefinite"/>';
          h += "</line>";
          h +=
            '<circle cx="' +
            nx.toFixed(1) +
            '" cy="' +
            ny.toFixed(1) +
            '" r="20" fill="#faf9f7" stroke="' +
            sub.color +
            '" stroke-width="1.2"/>';
          h +=
            '<text x="' +
            nx.toFixed(1) +
            '" y="' +
            (ny - 2).toFixed(1) +
            '" text-anchor="middle" fill="' +
            sub.color +
            '" font-family="monospace" font-size="11" font-weight="500">' +
            sub.abbr +
            "</text>";
          h +=
            '<text x="' +
            nx.toFixed(1) +
            '" y="' +
            (ny + 9).toFixed(1) +
            '" text-anchor="middle" fill="#a39e95" font-family="sans-serif" font-size="7">' +
            sub.label +
            "</text>";
        });
        h += "</svg></div></div>";

        // Introduction
        h += '<div class="section">';
        h += '<div class="section-label">About</div>';
        h += '<div class="section-heading">A Self-Hosted AI Gateway</div>';
        h +=
          '<div class="section-body">OpenClaw is a self-hosted personal AI assistant gateway that routes 40+ messaging channels through a unified intelligence layer. Built with TypeScript on Node.js, it combines LangGraph orchestration, autonomous model selection, scientific data mining, and domain-specific applications \u2014 all running on a private home network with zero cloud dependency for core operations.</div>';
        h += "</div>";

        // Stats
        h += '<div class="section"><div class="stats">';
        h +=
          '<div class="stat"><div class="stat-value">45</div><div class="stat-label">Extensions</div></div>';
        h +=
          '<div class="stat"><div class="stat-value">40+</div><div class="stat-label">Channels</div></div>';
        h +=
          '<div class="stat"><div class="stat-value">60+</div><div class="stat-label">API Endpoints</div></div>';
        h +=
          '<div class="stat"><div class="stat-value">6</div><div class="stat-label">Subsystems</div></div>';
        h += "</div></div>";

        // Tech stack
        h += '<div class="section"><div class="section-label">Technology</div>';
        h += '<div class="badge-row">';
        const stack = [
          "TypeScript",
          "Node.js",
          "Convex",
          "LangGraph",
          "Prometheus",
          "Grafana",
          "Apache",
          "Cloudflare",
        ];
        for (const s of stack) h += '<div class="badge">' + s + "</div>";
        h += "</div></div>";

        h += "</div>";

        // ==================================================================
        // TAB 2: Architecture
        // ==================================================================
        h += '<div class="panel' + (currentTab === "architecture" ? " active" : "") + '">';

        h += '<div class="section"><div class="section-label">System Architecture</div>';
        h += '<div class="section-heading">Concentric Design</div>';
        h +=
          '<div class="section-body" style="margin-bottom:24px">The gateway sits at the center, surrounded by six specialized subsystems on the inner ring. Channel adapters on the outer ring connect users to the intelligence layer.</div>';

        // Concentric SVG
        h +=
          '<div class="diagram"><svg viewBox="0 0 520 520" xmlns="http://www.w3.org/2000/svg" style="background:#faf9f7">';
        const acx = 260,
          acy = 260;
        h +=
          '<circle cx="' +
          acx +
          '" cy="' +
          acy +
          '" r="230" fill="none" stroke="#e8e4df" stroke-width="0.5" stroke-dasharray="3 4"/>';
        h +=
          '<circle cx="' +
          acx +
          '" cy="' +
          acy +
          '" r="125" fill="none" stroke="#e8e4df" stroke-width="0.5"/>';
        // Center
        h +=
          '<polygon points="' +
          hexPoints(acx, acy, 28) +
          '" fill="none" stroke="#8b6d4a" stroke-width="1.2" style="cursor:pointer" onclick="selectArchNode(\'gateway\')"/>';
        h +=
          '<text x="' +
          acx +
          '" y="' +
          (acy - 1) +
          '" text-anchor="middle" fill="#2c2a27" font-size="9" font-family="monospace" font-weight="500">OpenClaw</text>';
        h +=
          '<text x="' +
          acx +
          '" y="' +
          (acy + 9) +
          '" text-anchor="middle" fill="#a39e95" font-size="7" font-family="sans-serif">Gateway</text>';
        // Inner ring
        SUB_KEYS.forEach((key, i) => {
          const sub = SUBSYSTEMS[key];
          const angle = (Math.PI * 2 * i) / SUB_KEYS.length - Math.PI / 2;
          const nx = acx + 125 * Math.cos(angle),
            ny = acy + 125 * Math.sin(angle);
          h +=
            '<line x1="' +
            acx +
            '" y1="' +
            acy +
            '" x2="' +
            nx.toFixed(1) +
            '" y2="' +
            ny.toFixed(1) +
            '" stroke="' +
            sub.color +
            '" stroke-width="0.5" opacity="0.3" pointer-events="none"/>';
          const apiOk =
            (key === "neural-graph" && d.neuralStatus) ||
            (key === "data-mine" && d.dataMineStatus) ||
            (key === "wellness" && d.wellnessStatus) ||
            (key === "hive-mind" && d.identity) ||
            (key === "meta-engine" && d.neuralStatus) ||
            key === "hotel-scraper";
          h +=
            '<circle cx="' +
            nx.toFixed(1) +
            '" cy="' +
            ny.toFixed(1) +
            '" r="18" fill="#faf9f7" stroke="' +
            sub.color +
            '" stroke-width="1.2" style="cursor:pointer" onclick="selectArchNode(\'' +
            key +
            "')\"/>";
          h +=
            '<text x="' +
            nx.toFixed(1) +
            '" y="' +
            (ny + 3).toFixed(1) +
            '" text-anchor="middle" fill="' +
            sub.color +
            '" font-size="10" font-family="monospace" font-weight="500">' +
            sub.abbr +
            "</text>";
          h +=
            '<text x="' +
            nx.toFixed(1) +
            '" y="' +
            (ny + 30).toFixed(1) +
            '" text-anchor="middle" fill="#a39e95" font-size="7" font-family="sans-serif">' +
            sub.label +
            "</text>";
          h +=
            '<circle cx="' +
            (nx + 13).toFixed(1) +
            '" cy="' +
            (ny - 13).toFixed(1) +
            '" r="3" fill="' +
            (apiOk ? "#7a8f6d" : "#b8963e") +
            '"/>';
        });
        // Outer ring channels
        const outerCh = [
          "WhatsApp",
          "Telegram",
          "Discord",
          "Slack",
          "Signal",
          "Teams",
          "LINE",
          "Nostr",
          "Voice",
          "IRC",
          "iMessage",
          "Matrix",
          "Google Chat",
          "Feishu",
          "Twitch",
        ];
        outerCh.forEach((ch, i) => {
          const angle = (Math.PI * 2 * i) / outerCh.length - Math.PI / 2;
          const nx = acx + 230 * Math.cos(angle),
            ny = acy + 230 * Math.sin(angle);
          h +=
            '<line x1="' +
            (acx + 125 * Math.cos(angle)).toFixed(1) +
            '" y1="' +
            (acy + 125 * Math.sin(angle)).toFixed(1) +
            '" x2="' +
            nx.toFixed(1) +
            '" y2="' +
            ny.toFixed(1) +
            '" stroke="#e8e4df" stroke-width="0.5" stroke-dasharray="2 3" pointer-events="none"/>';
          h +=
            '<circle cx="' +
            nx.toFixed(1) +
            '" cy="' +
            ny.toFixed(1) +
            '" r="11" fill="#faf9f7" stroke="#e8e4df" stroke-width="0.8"/>';
          h +=
            '<text x="' +
            nx.toFixed(1) +
            '" y="' +
            (ny + 3).toFixed(1) +
            '" text-anchor="middle" fill="#a39e95" font-size="6" font-family="monospace">' +
            ch.slice(0, 6) +
            "</text>";
        });
        h += "</svg></div>";

        // Detail panel
        h += '<div class="detail' + (selectedArchNode ? " visible" : "") + '">';
        if (selectedArchNode === "gateway") {
          h += "<h3>OpenClaw Gateway</h3>";
          h +=
            "<p>Central message routing and AI orchestration hub. Processes incoming messages from 40+ channels, routes through intelligent agent selection, and returns responses via the originating channel.</p>";
          h +=
            "<ul><li>Channel multiplexing</li><li>Context management</li><li>Agent dispatch</li><li>Response formatting</li><li>Memory persistence</li></ul>";
        } else if (selectedArchNode && SUBSYSTEMS[selectedArchNode]) {
          const sub = SUBSYSTEMS[selectedArchNode];
          h += "<h3>" + sub.label + "</h3>";
          h += "<p>" + sub.desc + "</p>";
          h += "<ul>" + sub.caps.map((c) => "<li>" + c + "</li>").join("") + "</ul>";
        }
        h += "</div>";
        h += "</div>";

        // Data flow
        h += '<div class="section"><div class="section-label">Data Flow</div>';
        h += '<div class="pipeline">';
        [
          "User Message",
          "Channel",
          "Gateway",
          "Agent",
          "AI Processing",
          "Response",
          "Channel",
          "User",
        ].forEach((s, i) => {
          if (i > 0) h += '<div class="pipe-sep">\u2192</div>';
          h += '<div class="pipe-step">' + s + "</div>";
        });
        h += "</div></div>";

        h += "</div>";

        // ==================================================================
        // TAB 3: Channels
        // ==================================================================
        h += '<div class="panel' + (currentTab === "channels" ? " active" : "") + '">';
        h += '<div class="section"><div class="section-label">Messaging</div>';
        h += '<div class="section-heading">40+ Channel Integrations</div>';
        h +=
          '<div class="section-body">Each channel connects to the OpenClaw gateway via a dedicated adapter handling protocol translation, authentication, and bidirectional communication.</div>';
        h += "</div>";

        for (const [group, chs] of Object.entries(CHANNELS)) {
          h += '<div class="section ch-group"><div class="ch-group-label">' + group + "</div>";
          h += '<div class="ch-grid">';
          for (const ch of chs)
            h +=
              '<div class="ch-item"><div class="ch-icon">' +
              ch.icon +
              "</div><div>" +
              ch.name +
              "</div></div>";
          h += "</div></div>";
        }
        h += "</div>";

        // ==================================================================
        // TAB 4: Intelligence
        // ==================================================================
        h += '<div class="panel' + (currentTab === "intelligence" ? " active" : "") + '">';

        // Neural Graph
        h += '<div class="section"><div class="section-label">Neural Graph</div>';
        h += '<div class="section-heading">AI Orchestration Topology</div>';
        const ngPhase = neural.phase || neural.lifecycle?.phase || "\u2014";
        const ngNodes = topo.nodes?.length || neural.nodes || 0;
        const ngEdges = topo.edges?.length || neural.edges || 0;
        const ngFitness = neural.fitness?.average ?? neural.averageFitness ?? null;

        h += '<div class="stats" style="grid-template-columns:repeat(4,1fr);margin:16px 0 24px">';
        h +=
          '<div class="stat"><div class="stat-value" style="font-size:18px">' +
          esc(String(ngPhase)) +
          '</div><div class="stat-label">Phase</div></div>';
        h +=
          '<div class="stat"><div class="stat-value" style="font-size:28px">' +
          ngNodes +
          '</div><div class="stat-label">Nodes</div></div>';
        h +=
          '<div class="stat"><div class="stat-value" style="font-size:28px">' +
          ngEdges +
          '</div><div class="stat-label">Edges</div></div>';
        h +=
          '<div class="stat"><div class="stat-value" style="font-size:28px">' +
          (ngFitness != null ? ngFitness.toFixed(1) : "\u2014") +
          '</div><div class="stat-label">Avg Fitness</div></div>';
        h += "</div>";

        if (topo.nodes && topo.nodes.length > 0) {
          const gw = 700,
            gh = 380;
          const positions = layoutNodes(topo.nodes, topo.edges || [], gw, gh);
          h +=
            '<div class="diagram"><svg viewBox="0 0 ' +
            gw +
            " " +
            gh +
            '" xmlns="http://www.w3.org/2000/svg" style="background:#faf9f7">';
          for (const edge of topo.edges || []) {
            const a = positions[edge.sourceNodeId],
              b = positions[edge.targetNodeId];
            if (!a || !b) continue;
            h +=
              '<line x1="' +
              a.x.toFixed(1) +
              '" y1="' +
              a.y.toFixed(1) +
              '" x2="' +
              b.x.toFixed(1) +
              '" y2="' +
              b.y.toFixed(1) +
              '" stroke="' +
              (EDGE_COLORS[edge.type] || "#e8e4df") +
              '" stroke-width="0.8" opacity="0.35"/>';
          }
          for (const node of topo.nodes) {
            const p = positions[node.nodeId];
            if (!p) continue;
            const f = node.fitness ?? 50;
            const nc = fitnessColor(f);
            h +=
              '<circle cx="' +
              p.x.toFixed(1) +
              '" cy="' +
              p.y.toFixed(1) +
              '" r="7" fill="#faf9f7" stroke="' +
              nc +
              '" stroke-width="1.2"/>';
            h +=
              '<text x="' +
              p.x.toFixed(1) +
              '" y="' +
              (p.y + 18).toFixed(1) +
              '" text-anchor="middle" fill="#a39e95" font-size="7" font-family="monospace">' +
              esc((node.name || node.nodeId || "").slice(0, 14)) +
              "</text>";
          }
          h += "</svg></div>";
        } else {
          h +=
            '<div style="text-align:center;color:var(--text-light);padding:40px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius)">Topology data renders when the neural API returns node data</div>';
        }
        h += "</div>";

        // Meta Engine
        h += '<div class="section"><div class="section-label">Meta Engine</div>';
        h += '<div class="section-heading">Autonomous Model Selection</div>';
        h +=
          '<div class="section-body" style="margin-bottom:16px">Classifies incoming tasks, scores available models against requirements, and dynamically routes to the optimal provider.</div>';
        h += '<div class="pipeline">';
        ["Task Input", "Classifier", "Model Registry", "Scorer", "Best Model", "Execution"].forEach(
          (s, i) => {
            if (i > 0) h += '<div class="pipe-sep">\u2192</div>';
            h += '<div class="pipe-step">' + s + "</div>";
          },
        );
        h += "</div></div>";

        // Data Mine
        h += '<div class="section"><div class="section-label">Data Mine</div>';
        h += '<div class="section-heading">Scientific Analysis Engines</div>';
        h +=
          '<div class="section-body" style="margin-bottom:16px">5 specialized engines with 216 tests for comprehensive statistical and ML capabilities.</div>';
        h += '<div class="engine-grid">';
        const engines = [
          {
            name: "Statistics",
            items: ["Descriptive stats", "Correlation", "Regression", "Distribution tests"],
          },
          {
            name: "Time Series",
            items: ["Moving averages", "Trend detection", "Seasonality", "Forecasting"],
          },
          {
            name: "Clustering",
            items: ["K-means", "PCA", "Anomaly detection", "Silhouette scoring"],
          },
          {
            name: "Graph Analytics",
            items: ["Centrality", "Community detection", "Shortest path", "Network analysis"],
          },
          {
            name: "Experiments",
            items: ["A/B testing", "t-tests", "Effect size", "Confidence intervals"],
          },
        ];
        for (const e of engines) {
          h += '<div class="engine-card"><h4>' + e.name + "</h4><ul>";
          for (const item of e.items) h += "<li>" + item + "</li>";
          h += "</ul></div>";
        }
        h += "</div></div>";

        h += "</div>";

        // ==================================================================
        // TAB 5: Applications
        // ==================================================================
        h += '<div class="panel' + (currentTab === "applications" ? " active" : "") + '">';

        // Wellness
        h += '<div class="section"><div class="section-label">Wellness Concierge</div>';
        h += '<div class="section-heading">Executive Mental Wellbeing Platform</div>';
        h +=
          '<div class="section-body" style="margin-bottom:20px">8 specialized AI agents orchestrated for mental health support with PDPA privacy-by-design and 4-tier crisis escalation.</div>';

        h +=
          '<div class="diagram"><svg viewBox="0 0 480 280" xmlns="http://www.w3.org/2000/svg" style="background:#faf9f7">';
        const wcx = 240,
          wcy = 140,
          wr = 95;
        h +=
          '<circle cx="' +
          wcx +
          '" cy="' +
          wcy +
          '" r="20" fill="none" stroke="#a07070" stroke-width="1.2"/>';
        h +=
          '<text x="' +
          wcx +
          '" y="' +
          (wcy - 2) +
          '" text-anchor="middle" fill="#2c2a27" font-size="8" font-family="monospace" font-weight="500">EMWCP</text>';
        h +=
          '<text x="' +
          wcx +
          '" y="' +
          (wcy + 8) +
          '" text-anchor="middle" fill="#a39e95" font-size="6" font-family="sans-serif">8 agents</text>';
        WELLNESS_AGENTS.forEach((agent, i) => {
          const angle = (Math.PI * 2 * i) / WELLNESS_AGENTS.length - Math.PI / 2;
          const nx = wcx + wr * Math.cos(angle),
            ny = wcy + wr * Math.sin(angle);
          h +=
            '<line x1="' +
            wcx +
            '" y1="' +
            wcy +
            '" x2="' +
            nx.toFixed(1) +
            '" y2="' +
            ny.toFixed(1) +
            '" stroke="' +
            agent.color +
            '" stroke-width="0.5" opacity="0.25"/>';
          h +=
            '<circle cx="' +
            nx.toFixed(1) +
            '" cy="' +
            ny.toFixed(1) +
            '" r="14" fill="#faf9f7" stroke="' +
            agent.color +
            '" stroke-width="1"/>';
          h +=
            '<text x="' +
            nx.toFixed(1) +
            '" y="' +
            (ny + 3).toFixed(1) +
            '" text-anchor="middle" fill="' +
            agent.color +
            '" font-size="6.5" font-family="monospace">' +
            agentLabel(agent.name).split(" ")[0].slice(0, 8) +
            "</text>";
        });
        h += "</svg></div>";

        h += '<div class="badge-row">';
        h +=
          '<div class="badge"><span class="bdot" style="background:#a07070"></span> 8 AI Agents</div>';
        h +=
          '<div class="badge"><span class="bdot" style="background:#7a8f6d"></span> 10 Tools</div>';
        h +=
          '<div class="badge"><span class="bdot" style="background:#6b7394"></span> PDPA Aligned</div>';
        h +=
          '<div class="badge"><span class="bdot" style="background:#b8963e"></span> 4 Risk Tiers</div>';
        h += "</div></div>";

        // Hotel Scraper
        h += '<div class="section"><div class="section-label">Hotel Scraper</div>';
        h += '<div class="section-heading">Niseko Price Comparison</div>';
        h +=
          '<div class="section-body" style="margin-bottom:16px">Automated scraping from 5 data sources with entity resolution and Convex-backed storage for analytics.</div>';
        h += '<div class="pipeline">';
        [
          "Schedule",
          "Sources",
          "Browser",
          "Extraction",
          "Resolution",
          "Storage",
          "Analytics",
        ].forEach((s, i) => {
          if (i > 0) h += '<div class="pipe-sep">\u2192</div>';
          h += '<div class="pipe-step">' + s + "</div>";
        });
        h += "</div>";
        h += '<div class="badge-row">';
        for (const s of ["ratehawk", "google_hotels", "nisade", "roomboss", "rakuten_travel"])
          h +=
            '<div class="badge"><span class="bdot" style="background:#b8963e"></span> ' +
            s +
            "</div>";
        h += "</div></div>";

        h += "</div>";

        // ==================================================================
        // TAB 6: Infrastructure
        // ==================================================================
        h += '<div class="panel' + (currentTab === "infrastructure" ? " active" : "") + '">';

        h += '<div class="section"><div class="section-label">Network</div>';
        h += '<div class="section-heading">Physical Topology</div>';
        h +=
          '<div class="diagram"><svg viewBox="0 0 660 360" xmlns="http://www.w3.org/2000/svg" style="background:#faf9f7">';
        for (const link of NET_LINKS) {
          const from = NET_NODES.find((n) => n.id === link.from),
            to = NET_NODES.find((n) => n.id === link.to);
          if (!from || !to) continue;
          let dash = "none";
          if (link.type === "wireless") dash = "6 4";
          else if (link.type === "api") dash = "2 3";
          h +=
            '<line x1="' +
            from.x +
            '" y1="' +
            from.y +
            '" x2="' +
            to.x +
            '" y2="' +
            to.y +
            '" stroke="#d4d0ca" stroke-width="1" stroke-dasharray="' +
            dash +
            '"/>';
        }
        for (const node of NET_NODES) {
          const nc = ROLE_COLORS[node.role] || "#a39e95";
          h +=
            '<circle cx="' +
            node.x +
            '" cy="' +
            node.y +
            '" r="24" fill="#faf9f7" stroke="' +
            nc +
            '" stroke-width="1.5"/>';
          h +=
            '<text x="' +
            node.x +
            '" y="' +
            (node.y - 3) +
            '" text-anchor="middle" fill="' +
            nc +
            '" font-size="14">' +
            node.icon +
            "</text>";
          h +=
            '<text x="' +
            node.x +
            '" y="' +
            (node.y + 10) +
            '" text-anchor="middle" fill="#2c2a27" font-size="8" font-family="monospace" font-weight="500">' +
            node.label +
            "</text>";
          h +=
            '<text x="' +
            node.x +
            '" y="' +
            (node.y + 40) +
            '" text-anchor="middle" fill="#a39e95" font-size="7" font-family="monospace">' +
            node.ip +
            "</text>";
        }
        h +=
          '<text x="20" y="345" fill="#a39e95" font-size="8" font-family="monospace">\u2500\u2500 wired \u00A0\u00A0 - - wireless \u00A0\u00A0 \u00B7\u00B7 api</text>';
        h += "</svg></div></div>";

        // Monitoring
        h += '<div class="section"><div class="section-label">Monitoring</div>';
        h += '<div class="section-heading">Observability Pipeline</div>';
        h +=
          '<div class="section-body" style="margin-bottom:16px">Full observability with Prometheus metrics collection, Grafana visualization, alert management, and Discord notifications.</div>';
        h += '<div class="pipeline">';
        ["Prometheus", "Grafana", "Alert Manager", "Discord"].forEach((s, i) => {
          if (i > 0) h += '<div class="pipe-sep">\u2192</div>';
          h += '<div class="pipe-step">' + s + "</div>";
        });
        h += "</div>";

        if (scan.stations && scan.stations.length > 0) {
          h += '<div class="card-grid">';
          for (const st of scan.stations.slice(0, 6)) {
            const ok = st.reachable || st.online;
            h +=
              '<div class="card"><div class="card-title"><span class="marker" style="background:' +
              (ok ? "#7a8f6d" : "#a07070") +
              '"></span>' +
              esc(st.label || st.name || "Station") +
              "</div>";
            h +=
              '<div class="card-desc" style="font-family:var(--mono);font-size:12px">' +
              (ok ? "Online" : "Offline") +
              (st.ip ? " \u00B7 " + esc(st.ip) : "") +
              "</div></div>";
          }
          h += "</div>";
        }
        h += "</div>";

        h += "</div>";

        // ==================================================================
        // TAB 7: Dashboard
        // ==================================================================
        h += '<div class="panel' + (currentTab === "dashboard" ? " active" : "") + '">';

        h += '<div class="section"><div class="section-label">Live Status</div>';
        h += '<div class="section-heading">System Health</div>';
        h += '<div class="status-grid">';

        const hmUp = identity.uptime_seconds || identity.uptime;
        h +=
          '<div class="status-card"><div class="sc-header"><span class="sc-name">Hive Mind</span><span class="sc-dot" style="background:' +
          (d.identity ? "#7a8f6d" : "#a07070") +
          '"></span></div>';
        h += '<div class="sc-line">Uptime: ' + formatUptime(hmUp) + "</div>";
        h +=
          '<div class="sc-line">Station: ' + esc(identity.station_id || "\u2014") + "</div></div>";

        h +=
          '<div class="status-card"><div class="sc-header"><span class="sc-name">Neural Graph</span><span class="sc-dot" style="background:' +
          (d.neuralStatus ? "#7a8f6d" : "#a07070") +
          '"></span></div>';
        h += '<div class="sc-line">Phase: ' + esc(String(ngPhase)) + "</div>";
        h +=
          '<div class="sc-line">Fitness: ' +
          (ngFitness != null ? ngFitness.toFixed(1) + "%" : "\u2014") +
          "</div></div>";

        h +=
          '<div class="status-card"><div class="sc-header"><span class="sc-name">Meta Engine</span><span class="sc-dot" style="background:' +
          (d.neuralStatus ? "#7a8f6d" : "#b8963e") +
          '"></span></div>';
        h += '<div class="sc-line">Model selection: active</div>';
        h += '<div class="sc-line">Task routing: dynamic</div></div>';

        const dmEngines = dataMine.engines || 5;
        h +=
          '<div class="status-card"><div class="sc-header"><span class="sc-name">Data Mine</span><span class="sc-dot" style="background:' +
          (d.dataMineStatus ? "#7a8f6d" : "#a07070") +
          '"></span></div>';
        h += '<div class="sc-line">' + dmEngines + " engines active</div>";
        h +=
          '<div class="sc-line">' +
          (dataMine.totalAnalyses || dmStats.totalAnalyses || 0) +
          " analyses run</div></div>";

        h +=
          '<div class="status-card"><div class="sc-header"><span class="sc-name">Wellness</span><span class="sc-dot" style="background:' +
          (d.wellnessStatus ? "#7a8f6d" : "#a07070") +
          '"></span></div>';
        h +=
          '<div class="sc-line">' +
          (Array.isArray(agents) ? agents.length : 8) +
          " agents deployed</div>";
        h += '<div class="sc-line">' + (wellness.sessions || 0) + " sessions</div></div>";

        const devices = scan.stations?.length || 0;
        h +=
          '<div class="status-card"><div class="sc-header"><span class="sc-name">Network</span><span class="sc-dot" style="background:' +
          (d.scan ? "#7a8f6d" : "#b8963e") +
          '"></span></div>';
        h += '<div class="sc-line">' + devices + " devices tracked</div>";
        h += '<div class="sc-line">Dual-WAN: active</div></div>';

        const apiCount = [d.identity, d.neuralStatus, d.dataMineStatus, d.wellnessStatus].filter(
          Boolean,
        ).length;
        h +=
          '<div class="status-card"><div class="sc-header"><span class="sc-name">System</span><span class="sc-dot" style="background:' +
          (apiCount >= 3 ? "#7a8f6d" : "#b8963e") +
          '"></span></div>';
        h +=
          '<div class="sc-line">' +
          (apiCount >= 3 ? "Operational" : "Degraded") +
          " (" +
          apiCount +
          "/4 APIs)</div>";
        h += '<div class="sc-line">60s auto-refresh</div></div>';

        h += "</div></div>";
        h +=
          '<div class="section" style="text-align:center"><div class="section-body" style="font-size:12px;max-width:none">Auto-refreshing every 60 seconds \u00B7 Last update: ' +
          esc(now) +
          "</div></div>";
        h += "</div>";

        // Footer
        h +=
          '<div class="footer">OpenClaw \u00B7 Self-hosted AI Gateway \u00B7 v' +
          esc(identity.version || "\u2014") +
          "</div>";

        app.innerHTML = h;
      }

      // =====================================================================
      // INIT
      // =====================================================================
      async function init() {
        const d = await fetchAll();
        _lastData = d;
        render(d);
      }
      async function refresh() {
        try {
          const d = await fetchAll();
          _lastData = d;
          render(d);
        } catch {}
      }
      init().then(() => setInterval(refresh, 60000));
    </script>
  </body>
</html>
